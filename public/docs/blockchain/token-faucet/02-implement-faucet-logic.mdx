# ðŸ’§ Implementing the Private Faucet Logic

Now let's build the core functionality of our privacy-preserving token faucet. We'll create a smart contract that distributes tokens while keeping the amounts completely private!

---

## 1. Create the Basic Contract Structure ðŸ’¬

**Action Required:** Copy and paste this prompt to create the foundation:

<div style={{
  background: 'linear-gradient(to right, #3b82f6, #8b5cf6)',
  padding: '2px',
  borderRadius: '12px',
  margin: '20px 0',
  boxShadow: '0 0 20px rgba(139, 92, 246, 0.3)'
}}>
  <div style={{
    background: '#0f172a',
    borderRadius: '11px',
    padding: '24px',
    color: '#e2e8f0',
    position: 'relative'
  }}>
    <div style={{
      display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'
    }}>
      <span style={{color: '#94a3b8', textTransform: 'uppercase', fontSize: '0.75rem', letterSpacing: '1px', fontWeight: 'bold'}}>
        ðŸ‘‡ COPY THIS EXACT PROMPT
      </span>
      <span style={{fontSize: '0.8rem', background: '#334155', padding: '4px 8px', borderRadius: '4px', color: '#cbd5e1'}}>
        Ctrl + C
      </span>
    </div>

    <div style={{
      fontSize: '1.1rem',
      lineHeight: '1.6',
      fontFamily: 'system-ui, -apple-system, sans-serif',
      borderLeft: '4px solid #8b5cf6',
      paddingLeft: '16px',
      color: '#fff'
    }}>
      "Create a PrivateFaucet.sol contract that inherits from the COTI privacy framework. Include state variables for: the drip amount (encrypted using ctUint64), cooldown period, last claim timestamps for each address, and an owner address. Import the necessary MPC libraries from @coti-io/coti-contracts."
    </div>
  </div>
</div>

---

## 2. Understanding the State Variables ðŸ“Š

Here's what each variable does:

<div style={{
  background: 'rgba(15, 23, 42, 0.8)',
  border: '1px solid rgba(139, 92, 246, 0.3)',
  borderRadius: '12px',
  padding: '20px',
  margin: '20px 0'
}}>

| Variable | Type | Purpose |
|----------|------|---------|
| `dripAmount` | `ctUint64` | The encrypted amount users receive (private!) |
| `cooldownPeriod` | `uint256` | Time between claims (in seconds) |
| `lastClaim` | `mapping` | Tracks when each address last claimed |
| `owner` | `address` | Admin who can refill and configure |

</div>

<div style={{
  background: 'rgba(245, 158, 11, 0.1)',
  border: '1px solid rgba(245, 158, 11, 0.3)',
  borderRadius: '8px',
  padding: '16px',
  margin: '10px 0'
}}>
  <span style={{color: '#f59e0b', fontWeight: 'bold'}}>ðŸ’¡ Why Private Drip Amount?</span>
  <span style={{marginLeft: '8px'}}>By keeping the drip amount encrypted, observers cannot see how much each user receives. This protects user privacy and prevents gaming the system!</span>
</div>

---

## 3. Implement the Claim Function ðŸŽ¯

**Action Required:** Now let's add the main claim functionality:

<div style={{
  background: 'linear-gradient(to right, #3b82f6, #8b5cf6)',
  padding: '2px',
  borderRadius: '12px',
  margin: '20px 0',
  boxShadow: '0 0 20px rgba(139, 92, 246, 0.3)'
}}>
  <div style={{
    background: '#0f172a',
    borderRadius: '11px',
    padding: '24px',
    color: '#e2e8f0',
    position: 'relative'
  }}>
    <div style={{
      display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'
    }}>
      <span style={{color: '#94a3b8', textTransform: 'uppercase', fontSize: '0.75rem', letterSpacing: '1px', fontWeight: 'bold'}}>
        ðŸ‘‡ COPY THIS EXACT PROMPT
      </span>
      <span style={{fontSize: '0.8rem', background: '#334155', padding: '4px 8px', borderRadius: '4px', color: '#cbd5e1'}}>
        Ctrl + C
      </span>
    </div>

    <div style={{
      fontSize: '1.1rem',
      lineHeight: '1.6',
      fontFamily: 'system-ui, -apple-system, sans-serif',
      borderLeft: '4px solid #8b5cf6',
      paddingLeft: '16px',
      color: '#fff'
    }}>
      "Add a claim() function to the PrivateFaucet contract. The function should: 1) Check that the caller has waited the cooldown period since their last claim, 2) Transfer the encrypted dripAmount to the caller using the Private ERC20 transfer, 3) Update the lastClaim timestamp for the caller, 4) Emit a Claimed event (without revealing the amount). Add clear comments explaining each step."
    </div>
  </div>
</div>

---

## 4. How Private Transfers Work ðŸ”’

When we transfer tokens in our faucet, here's what happens:

<div style={{
  background: 'rgba(15, 23, 42, 0.8)',
  border: '1px solid rgba(59, 130, 246, 0.3)',
  borderRadius: '12px',
  padding: '20px',
  margin: '20px 0'
}}>

```
1. User calls claim()
       â†“
2. Contract checks cooldown âœ“
       â†“
3. Contract transfers encrypted amount
   (No one can see the value!)
       â†“
4. User's balance increases privately
   (Only they can decrypt it)
```

</div>

<div style={{
  background: 'rgba(16, 185, 129, 0.1)',
  border: '1px solid rgba(16, 185, 129, 0.3)',
  borderRadius: '8px',
  padding: '16px',
  margin: '10px 0'
}}>
  <span style={{color: '#10b981', fontWeight: 'bold'}}>ðŸ“š Reference:</span>
  <a href="https://docs.coti.io/coti-documentation/build-on-coti/tools/contracts-library/tokens/private-erc20"
     style={{color: '#60a5fa', marginLeft: '8px'}}
     target="_blank">
    Private ERC20 Transfer Documentation
  </a>
</div>

---

## 5. Add Admin Functions ðŸ‘‘

**Action Required:** Let's add owner-only functions to manage the faucet:

<div style={{
  background: 'linear-gradient(to right, #3b82f6, #8b5cf6)',
  padding: '2px',
  borderRadius: '12px',
  margin: '20px 0',
  boxShadow: '0 0 20px rgba(139, 92, 246, 0.3)'
}}>
  <div style={{
    background: '#0f172a',
    borderRadius: '11px',
    padding: '24px',
    color: '#e2e8f0',
    position: 'relative'
  }}>
    <div style={{
      display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'
    }}>
      <span style={{color: '#94a3b8', textTransform: 'uppercase', fontSize: '0.75rem', letterSpacing: '1px', fontWeight: 'bold'}}>
        ðŸ‘‡ COPY THIS EXACT PROMPT
      </span>
      <span style={{fontSize: '0.8rem', background: '#334155', padding: '4px 8px', borderRadius: '4px', color: '#cbd5e1'}}>
        Ctrl + C
      </span>
    </div>

    <div style={{
      fontSize: '1.1rem',
      lineHeight: '1.6',
      fontFamily: 'system-ui, -apple-system, sans-serif',
      borderLeft: '4px solid #8b5cf6',
      paddingLeft: '16px',
      color: '#fff'
    }}>
      "Add admin functions to the PrivateFaucet: 1) setDripAmount(itUint64 newAmount) - to change the drip amount (takes input type for encryption), 2) setCooldownPeriod(uint256 newPeriod) - to adjust cooldown, 3) refill(itUint64 amount) - to add more tokens to the faucet, 4) emergencyWithdraw() - to recover all tokens. All should be owner-only. Use the onlyOwner modifier pattern."
    </div>
  </div>
</div>

---

## 6. Understanding Input Types ðŸ“¥

When users send data to our contract, we use `itUint64` (input type):

<div style={{
  background: 'rgba(15, 23, 42, 0.8)',
  border: '1px solid rgba(139, 92, 246, 0.3)',
  borderRadius: '12px',
  padding: '20px',
  margin: '20px 0'
}}>

| Type | Meaning | Usage |
|------|---------|-------|
| `itUint64` | Input Type | Data coming INTO the contract |
| `ctUint64` | Ciphertext | Data stored ON the contract |
| `gtUint64` | Garbled | Data being PROCESSED |

</div>

<div style={{
  background: 'rgba(245, 158, 11, 0.1)',
  border: '1px solid rgba(245, 158, 11, 0.3)',
  borderRadius: '8px',
  padding: '16px',
  margin: '10px 0'
}}>
  <span style={{color: '#f59e0b', fontWeight: 'bold'}}>ðŸ’¡ Remember:</span>
  <span style={{marginLeft: '8px'}}>Input (it) â†’ Store as Ciphertext (ct) â†’ Process as Garbled (gt)</span>
</div>

---

## 7. Add View Functions ðŸ‘€

**Action Required:** Finally, add functions to check status:

<div style={{
  background: 'linear-gradient(to right, #3b82f6, #8b5cf6)',
  padding: '2px',
  borderRadius: '12px',
  margin: '20px 0',
  boxShadow: '0 0 20px rgba(139, 92, 246, 0.3)'
}}>
  <div style={{
    background: '#0f172a',
    borderRadius: '11px',
    padding: '24px',
    color: '#e2e8f0',
    position: 'relative'
  }}>
    <div style={{
      display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'
    }}>
      <span style={{color: '#94a3b8', textTransform: 'uppercase', fontSize: '0.75rem', letterSpacing: '1px', fontWeight: 'bold'}}>
        ðŸ‘‡ COPY THIS EXACT PROMPT
      </span>
      <span style={{fontSize: '0.8rem', background: '#334155', padding: '4px 8px', borderRadius: '4px', color: '#cbd5e1'}}>
        Ctrl + C
      </span>
    </div>

    <div style={{
      fontSize: '1.1rem',
      lineHeight: '1.6',
      fontFamily: 'system-ui, -apple-system, sans-serif',
      borderLeft: '4px solid #8b5cf6',
      paddingLeft: '16px',
      color: '#fff'
    }}>
      "Add view functions to the PrivateFaucet: 1) canClaim(address user) - returns true if user can claim now, 2) timeUntilNextClaim(address user) - returns seconds until user can claim again, 3) getCooldownPeriod() - returns the current cooldown period. These help users know when they can use the faucet."
    </div>
  </div>
</div>

---

## âœ… Checkpoint

Your PrivateFaucet contract now includes:
- âœ… Encrypted drip amount storage
- âœ… Cooldown mechanism to prevent spam
- âœ… Private token transfers
- âœ… Admin functions for management
- âœ… View functions for user information

**Next Step:** Deploy and test your faucet on COTI devnet!
