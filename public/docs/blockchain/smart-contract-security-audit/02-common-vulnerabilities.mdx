# Common Smart Contract Vulnerabilities

This guide covers the most common security vulnerabilities found in smart contracts.

## 1. Reentrancy Attacks

### What is Reentrancy?

A reentrancy attack occurs when an external call is made to an untrusted contract before the state is updated.

### Example of Vulnerable Code

```solidity
contract VulnerableBank {
  mapping(address => uint) public balances;

  function withdraw(uint amount) public {
    require(balances[msg.sender] >= amount);

    // Vulnerable: External call before state update
    (bool success, ) = msg.sender.call{value: amount}("");
    require(success);

    balances[msg.sender] -= amount;
  }
}
```

### Secure Implementation

```solidity
contract SecureBank {
  mapping(address => uint) public balances;

  function withdraw(uint amount) public {
    require(balances[msg.sender] >= amount);

    // Safe: Update state BEFORE external call
    balances[msg.sender] -= amount;

    (bool success, ) = msg.sender.call{value: amount}("");
    require(success);
  }
}
```

## 2. Integer Overflow/Underflow

### Before Solidity 0.8.0

```solidity
// Vulnerable to overflow
uint8 balance = 255;
balance += 1; // Wraps to 0!
```

### Solution: Use SafeMath or Solidity 0.8+

```solidity
// Solidity 0.8+ has built-in overflow checks
pragma solidity ^0.8.0;

uint8 balance = 255;
balance += 1; // Reverts automatically
```

## 3. Access Control Issues

### Common Mistake

```solidity
// Anyone can call this!
function updateOwner(address newOwner) public {
  owner = newOwner;
}
```

### Proper Access Control

```solidity
modifier onlyOwner() {
  require(msg.sender == owner, "Not authorized");
  _;
}

function updateOwner(address newOwner) public onlyOwner {
  owner = newOwner;
}
```

## Prevention Checklist

- ✅ Follow Checks-Effects-Interactions pattern
- ✅ Use OpenZeppelin's battle-tested contracts
- ✅ Add reentrancy guards (ReentrancyGuard)
- ✅ Implement proper access control
- ✅ Use Solidity 0.8+ for automatic overflow checks
- ✅ Conduct thorough testing
- ✅ Get professional audits before mainnet deployment
