# Implementing the ERC721 NFT Contract

Now that your environment is ready, let's build the NFT contract that will serve as the foundation for our royalty system. We'll create an ERC721 token with **privacy-preserving royalty tracking** using COTI's MPC technology.

---

## 1. Create the Base NFT Contract

**Action Required:** Use COTI MCP to generate the foundational ERC721 contract:

<div style={{
  background: 'linear-gradient(to right, #3b82f6, #8b5cf6)',
  padding: '2px',
  borderRadius: '12px',
  margin: '20px 0',
  boxShadow: '0 0 20px rgba(139, 92, 246, 0.3)'
}}>
  <div style={{
    background: '#0f172a',
    borderRadius: '11px',
    padding: '24px',
    color: '#e2e8f0',
    position: 'relative'
  }}>
    <div style={{
      display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'
    }}>
      <span style={{color: '#94a3b8', textTransform: 'uppercase', fontSize: '0.75rem', letterSpacing: '1px', fontWeight: 'bold'}}>
        COPY THIS EXACT PROMPT
      </span>
      <span style={{fontSize: '0.8rem', background: '#334155', padding: '4px 8px', borderRadius: '4px', color: '#cbd5e1'}}>
        Ctrl + C
      </span>
    </div>

    <div style={{
      fontSize: '1.1rem',
      lineHeight: '1.6',
      fontFamily: 'system-ui, -apple-system, sans-serif',
      borderLeft: '4px solid #8b5cf6',
      paddingLeft: '16px',
      color: '#fff'
    }}>
      "Create a PrivateRoyaltyNFT smart contract on COTI that inherits from OpenZeppelin's ERC721, ERC721URIStorage, ERC721Enumerable, and ERC2981 for royalty support. Also inherit from COTI's MpcCore and AccountOnboard. Include a mapping to track the original creator of each token and a configurable default royalty percentage. Add a mint function that sets the royalty info for each token."
    </div>
  </div>
</div>

---

## 2. Understanding ERC721 Components

Let's understand the key components we're combining:

<div style={{
  background: 'rgba(15, 23, 42, 0.9)',
  borderRadius: '12px',
  padding: '24px',
  margin: '20px 0',
  border: '1px solid rgba(139, 92, 246, 0.3)'
}}>

### ERC721 (Base)
Core NFT functionality: ownerOf, transferFrom, approve, etc.

### ERC721URIStorage
Stores metadata URI for each token (images, attributes, etc.)

### ERC721Enumerable
Enables enumeration of all tokens and tokens by owner.

### ERC2981
Standard royalty interface that marketplaces can query.

</div>

---

## 3. Add the Mint Function with Royalties

**Action Required:** Implement the minting logic with royalty setup:

<div style={{
  background: 'linear-gradient(to right, #3b82f6, #8b5cf6)',
  padding: '2px',
  borderRadius: '12px',
  margin: '20px 0',
  boxShadow: '0 0 20px rgba(139, 92, 246, 0.3)'
}}>
  <div style={{
    background: '#0f172a',
    borderRadius: '11px',
    padding: '24px',
    color: '#e2e8f0',
    position: 'relative'
  }}>
    <div style={{
      display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'
    }}>
      <span style={{color: '#94a3b8', textTransform: 'uppercase', fontSize: '0.75rem', letterSpacing: '1px', fontWeight: 'bold'}}>
        COPY THIS EXACT PROMPT
      </span>
      <span style={{fontSize: '0.8rem', background: '#334155', padding: '4px 8px', borderRadius: '4px', color: '#cbd5e1'}}>
        Ctrl + C
      </span>
    </div>

    <div style={{
      fontSize: '1.1rem',
      lineHeight: '1.6',
      fontFamily: 'system-ui, -apple-system, sans-serif',
      borderLeft: '4px solid #8b5cf6',
      paddingLeft: '16px',
      color: '#fff'
    }}>
      "Add a mintNFT function to the PrivateRoyaltyNFT contract that takes a tokenURI string and an optional royalty percentage (uint96, in basis points where 10000 = 100%). The function should mint a new token to the caller, set the token URI, record the caller as the original creator in a mapping, and set the token's royalty info using _setTokenRoyalty from ERC2981. Use a default royalty of 500 (5%) if no custom percentage is provided. Emit an event with the tokenId and creator address."
    </div>
  </div>
</div>

---

## 4. Implement Token Creator Tracking

**Action Required:** Add functions to query and manage creator information:

<div style={{
  background: 'linear-gradient(to right, #3b82f6, #8b5cf6)',
  padding: '2px',
  borderRadius: '12px',
  margin: '20px 0',
  boxShadow: '0 0 20px rgba(139, 92, 246, 0.3)'
}}>
  <div style={{
    background: '#0f172a',
    borderRadius: '11px',
    padding: '24px',
    color: '#e2e8f0',
    position: 'relative'
  }}>
    <div style={{
      display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'
    }}>
      <span style={{color: '#94a3b8', textTransform: 'uppercase', fontSize: '0.75rem', letterSpacing: '1px', fontWeight: 'bold'}}>
        COPY THIS EXACT PROMPT
      </span>
      <span style={{fontSize: '0.8rem', background: '#334155', padding: '4px 8px', borderRadius: '4px', color: '#cbd5e1'}}>
        Ctrl + C
      </span>
    </div>

    <div style={{
      fontSize: '1.1rem',
      lineHeight: '1.6',
      fontFamily: 'system-ui, -apple-system, sans-serif',
      borderLeft: '4px solid #8b5cf6',
      paddingLeft: '16px',
      color: '#fff'
    }}>
      "Add a getTokenCreator function that returns the original creator address for a given tokenId. Also add a getCreatorTokens function that returns all tokenIds created by a specific address using the ERC721Enumerable functionality. Include a modifier onlyTokenCreator that restricts certain functions to only the original creator of a token."
    </div>
  </div>
</div>

---

## 5. Understanding ERC2981 Royalty Info

The ERC2981 standard provides a `royaltyInfo` function that marketplaces call:

<div style={{
  background: 'rgba(15, 23, 42, 0.8)',
  border: '1px solid rgba(139, 92, 246, 0.3)',
  borderRadius: '12px',
  padding: '20px',
  margin: '20px 0',
  fontFamily: 'monospace',
  fontSize: '14px',
  color: '#e2e8f0'
}}>
<pre style={{margin: 0}}>{`// ERC2981 Standard Interface
function royaltyInfo(
    uint256 tokenId,
    uint256 salePrice
) external view returns (
    address receiver,    // Who gets the royalty
    uint256 royaltyAmount // How much they get
);

// Example: 5% royalty on 1 ETH sale
// Returns: (creatorAddress, 0.05 ETH)`}</pre>
</div>

<div style={{
  background: 'rgba(245, 158, 11, 0.1)',
  border: '1px solid rgba(245, 158, 11, 0.3)',
  borderRadius: '8px',
  padding: '16px',
  margin: '20px 0'
}}>
  <span style={{color: '#f59e0b', fontWeight: 'bold'}}>Important:</span>
  <span style={{color: '#e2e8f0', marginLeft: '8px'}}>
    ERC2981 only provides royalty information. The actual payment enforcement requires marketplace integration (covered in Step 4).
  </span>
</div>

---

## 6. Add Batch Minting Support

**Action Required:** Enable efficient batch minting for collections:

<div style={{
  background: 'linear-gradient(to right, #3b82f6, #8b5cf6)',
  padding: '2px',
  borderRadius: '12px',
  margin: '20px 0',
  boxShadow: '0 0 20px rgba(139, 92, 246, 0.3)'
}}>
  <div style={{
    background: '#0f172a',
    borderRadius: '11px',
    padding: '24px',
    color: '#e2e8f0',
    position: 'relative'
  }}>
    <div style={{
      display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'
    }}>
      <span style={{color: '#94a3b8', textTransform: 'uppercase', fontSize: '0.75rem', letterSpacing: '1px', fontWeight: 'bold'}}>
        COPY THIS EXACT PROMPT
      </span>
      <span style={{fontSize: '0.8rem', background: '#334155', padding: '4px 8px', borderRadius: '4px', color: '#cbd5e1'}}>
        Ctrl + C
      </span>
    </div>

    <div style={{
      fontSize: '1.1rem',
      lineHeight: '1.6',
      fontFamily: 'system-ui, -apple-system, sans-serif',
      borderLeft: '4px solid #8b5cf6',
      paddingLeft: '16px',
      color: '#fff'
    }}>
      "Add a batchMint function that allows creators to mint multiple NFTs in a single transaction. The function should take an array of tokenURIs and a single royalty percentage that applies to all minted tokens. Include a reasonable limit (e.g., 50 tokens per batch) to prevent gas issues. Emit events for each minted token."
    </div>
  </div>
</div>

---

## 7. Override Required Functions

When inheriting from multiple OpenZeppelin contracts, we need to resolve conflicts:

<div style={{
  background: 'linear-gradient(to right, #3b82f6, #8b5cf6)',
  padding: '2px',
  borderRadius: '12px',
  margin: '20px 0',
  boxShadow: '0 0 20px rgba(139, 92, 246, 0.3)'
}}>
  <div style={{
    background: '#0f172a',
    borderRadius: '11px',
    padding: '24px',
    color: '#e2e8f0',
    position: 'relative'
  }}>
    <div style={{
      display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px'
    }}>
      <span style={{color: '#94a3b8', textTransform: 'uppercase', fontSize: '0.75rem', letterSpacing: '1px', fontWeight: 'bold'}}>
        COPY THIS EXACT PROMPT
      </span>
      <span style={{fontSize: '0.8rem', background: '#334155', padding: '4px 8px', borderRadius: '4px', color: '#cbd5e1'}}>
        Ctrl + C
      </span>
    </div>

    <div style={{
      fontSize: '1.1rem',
      lineHeight: '1.6',
      fontFamily: 'system-ui, -apple-system, sans-serif',
      borderLeft: '4px solid #8b5cf6',
      paddingLeft: '16px',
      color: '#fff'
    }}>
      "Add the required override functions for the PrivateRoyaltyNFT contract. Override _update, _increaseBalance, tokenURI, and supportsInterface to properly combine ERC721, ERC721URIStorage, ERC721Enumerable, and ERC2981 functionalities. Make sure supportsInterface returns true for all supported interfaces including ERC2981."
    </div>
  </div>
</div>

---

## 8. Contract Structure So Far

Your NFT contract should now look like this:

<div style={{
  background: 'rgba(15, 23, 42, 0.8)',
  border: '1px solid rgba(139, 92, 246, 0.3)',
  borderRadius: '12px',
  padding: '20px',
  margin: '20px 0',
  fontFamily: 'monospace',
  fontSize: '14px',
  color: '#e2e8f0'
}}>
<pre style={{margin: 0}}>{`contract PrivateRoyaltyNFT is
    ERC721,
    ERC721URIStorage,
    ERC721Enumerable,
    ERC2981,
    MpcCore,
    AccountOnboard
{
    // State Variables
    uint256 private _tokenIdCounter;
    uint96 public defaultRoyaltyBps = 500; // 5%
    mapping(uint256 => address) public tokenCreators;

    // Events
    event NFTMinted(uint256 tokenId, address creator, string uri);

    // Core Functions
    mintNFT(string uri, uint96 royaltyBps)
    batchMint(string[] uris, uint96 royaltyBps)
    getTokenCreator(uint256 tokenId)
    getCreatorTokens(address creator)

    // Overrides (for multiple inheritance)
    _update(...)
    _increaseBalance(...)
    tokenURI(...)
    supportsInterface(...)
}`}</pre>
</div>

---

## Checkpoint

You now have:
- An ERC721 NFT contract with URI storage
- ERC2981 royalty standard implementation
- Token creator tracking system
- Batch minting capability
- Proper inheritance resolution

**Next Step:** Implement the privacy-preserving royalty logic using COTI's MPC!
