# üèóÔ∏è Phase 1: DeFi Swap App Architecture & Foundation

Welcome to building a **Privacy-Preserving DEX (Decentralized Exchange)** mobile application! This advanced tutorial will guide you through creating a Uniswap-style AMM (Automated Market Maker) with complete privacy using COTI's MPC technology.

This is an **enterprise-grade** project combining:
- **iOS Native Development** with SwiftUI
- **Smart Contract Development** for AMM/DEX
- **Privacy-Preserving Finance** using COTI's MPC

---

## üéØ What We're Building

A complete DeFi mobile app featuring:

<div style={{
  background: 'rgba(15, 23, 42, 0.8)',
  border: '1px solid rgba(139, 92, 246, 0.3)',
  borderRadius: '12px',
  padding: '20px',
  margin: '20px 0'
}}>

| Feature | Description |
|---------|-------------|
| **Token Swaps** | Exchange tokens using constant product AMM |
| **Liquidity Pools** | Add/remove liquidity and earn fees |
| **Private Balances** | All balances encrypted on-chain |
| **Price Discovery** | Real-time price calculations |
| **Slippage Protection** | Configurable slippage tolerance |
| **Transaction History** | Encrypted swap history |

</div>

---

## ‚ö° ACTION: ARCHITECT THE iOS + SMART CONTRACT PROJECT

**Mission:** Use your **AI Assistant** (Claude recommended). Copy the prompt below and paste it into the chat.

<div style={{
  background: 'linear-gradient(135deg, #1e40af, #7c3aed)',
  padding: '3px',
  borderRadius: '16px',
  margin: '30px 0',
  boxShadow: '0 0 60px -15px rgba(30, 64, 175, 0.6)'
}}>
  <div style={{
    background: '#0a0f1e',
    borderRadius: '13px',
    color: '#e2e8f0',
    overflow: 'hidden',
    fontFamily: 'Menlo, Monaco, Consolas, monospace',
    position: 'relative'
  }}>

    {/* Header Bar */}
    <div style={{
      background: 'rgba(255, 255, 255, 0.05)',
      borderBottom: '1px solid #334155',
      padding: '12px 20px',
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center'
    }}>
      <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
        <div style={{
            width:'12px', height:'12px', background:'#8b5cf6', borderRadius:'50%',
            boxShadow:'0 0 12px #8b5cf6'
        }}></div>
        <span style={{color: '#a78bfa', fontWeight: 'bold', fontSize: '0.85rem', letterSpacing: '0.5px'}}>
          DEFI_SWAP_ARCHITECT.prompt
        </span>
        <span style={{
            background: 'rgba(139, 92, 246, 0.2)', color: '#c4b5fd', fontSize: '0.65rem',
            padding: '2px 8px', borderRadius: '4px', border: '1px solid rgba(139, 92, 246, 0.3)'
        }}>AMM + iOS</span>
      </div>

      <button
        style={{
            background: 'linear-gradient(90deg, #7c3aed, #ec4899)',
            border: 'none',
            color: 'white',
            padding: '8px 16px',
            borderRadius: '6px',
            fontSize: '0.75rem',
            cursor: 'pointer',
            fontWeight: 'bold',
            display: 'flex', alignItems: 'center', gap: '8px',
            transition: 'transform 0.1s',
            boxShadow: '0 4px 12px rgba(139, 92, 246, 0.4)'
        }}
        onMouseOver={(e) => e.currentTarget.style.transform = 'translateY(-1px)'}
        onMouseOut={(e) => e.currentTarget.style.transform = 'translateY(0)'}
        onClick={() => {
            const promptText = document.getElementById('defi-architecture-prompt').innerText;
            navigator.clipboard.writeText(promptText);
            alert("DeFi Architecture Blueprint Copied! üöÄ");
        }}
      >
        <span>‚ö° COPY FULL ARCHITECTURE</span>
      </button>
    </div>

    {/* Scrollable Content Area */}
    <div id="defi-architecture-prompt" style={{
      padding: '24px',
      maxHeight: '600px',
      overflowY: 'auto',
      whiteSpace: 'pre-wrap',
      fontSize: '0.85rem',
      lineHeight: '1.6',
      color: '#cbd5e1'
    }}>
{`You are a senior blockchain architect and iOS developer specializing in DeFi protocols, SwiftUI, and privacy-preserving smart contracts. Your task is to create a complete, production-ready DeFi Swap application (similar to Uniswap) that runs on COTI blockchain with full privacy.

====================================================================
üéØ PROJECT OVERVIEW: PRIVACY-PRESERVING DEX
====================================================================

Application: Native iOS DEX (Decentralized Exchange) Mobile App
Smart Contracts: AMM (Automated Market Maker) with Privacy
Target iOS: iOS 16.0+
Architecture: Clean Architecture + MVVM + Blockchain Layer
Blockchain: COTI (EVM-compatible with MPC privacy)
Key Feature: All balances and swap amounts are ENCRYPTED on-chain

====================================================================
üìê SYSTEM ARCHITECTURE
====================================================================

This project has TWO major components:

COMPONENT A: SMART CONTRACTS (Solidity + COTI Privacy)
‚îú‚îÄ‚îÄ PrivateERC20Factory.sol    - Deploy new private tokens
‚îú‚îÄ‚îÄ PrivateAMM.sol             - Core AMM with x*y=k formula
‚îú‚îÄ‚îÄ PrivateLiquidityPool.sol   - LP token management
‚îú‚îÄ‚îÄ PrivateRouter.sol          - Swap routing and calculations
‚îî‚îÄ‚îÄ PriceOracle.sol            - Price feed aggregator

COMPONENT B: iOS APPLICATION (SwiftUI + Web3)
‚îú‚îÄ‚îÄ Domain Layer               - Business logic, entities
‚îú‚îÄ‚îÄ Data Layer                 - Blockchain interactions
‚îú‚îÄ‚îÄ Presentation Layer         - SwiftUI views
‚îî‚îÄ‚îÄ Core                       - DI, utilities, constants

====================================================================
üìÅ COMPLETE PROJECT STRUCTURE
====================================================================

PrivateDEX/
‚îú‚îÄ‚îÄ SmartContracts/
‚îÇ   ‚îú‚îÄ‚îÄ contracts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PrivateAMM.sol
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PrivateLiquidityPool.sol
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PrivateRouter.sol
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tokens/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PrivateERC20.sol
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PrivateLPToken.sol
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PrivateERC20Factory.sol
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ libraries/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MathLib.sol
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SafeMath.sol
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PriceCalculator.sol
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ interfaces/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ IPrivateAMM.sol
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ IPrivateRouter.sol
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ IPrivateLiquidityPool.sol
‚îÇ   ‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deploy.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ createPool.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ addLiquidity.js
‚îÇ   ‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PrivateAMM.test.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LiquidityPool.test.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Router.test.js
‚îÇ   ‚îú‚îÄ‚îÄ hardhat.config.js
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îî‚îÄ‚îÄ iOSApp/
    ‚îú‚îÄ‚îÄ PrivateDEX/
    ‚îÇ   ‚îú‚îÄ‚îÄ App/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PrivateDEXApp.swift
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppCoordinator.swift
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AppState.swift
    ‚îÇ   ‚îú‚îÄ‚îÄ Domain/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Entities/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Token.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Pool.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LiquidityPosition.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SwapQuote.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SwapTransaction.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Wallet.swift
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UseCases/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Swap/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GetSwapQuoteUseCase.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ExecuteSwapUseCase.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GetSwapHistoryUseCase.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Liquidity/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddLiquidityUseCase.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RemoveLiquidityUseCase.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GetPoolsUseCase.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Tokens/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GetTokensUseCase.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GetTokenBalanceUseCase.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ApproveTokenUseCase.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Wallet/
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ConnectWalletUseCase.swift
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ GetWalletBalanceUseCase.swift
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ SignTransactionUseCase.swift
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RepositoryProtocols/
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ SwapRepositoryProtocol.swift
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ LiquidityRepositoryProtocol.swift
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ TokenRepositoryProtocol.swift
    ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ WalletRepositoryProtocol.swift
    ‚îÇ   ‚îú‚îÄ‚îÄ Data/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Repositories/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SwapRepository.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LiquidityRepository.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TokenRepository.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WalletRepository.swift
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Blockchain/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Web3Manager.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ContractManager.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AMMContractService.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RouterContractService.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TokenContractService.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WalletConnectManager.swift
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Network/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PriceAPIClient.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TokenListService.swift
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Local/
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ FavoriteTokensStorage.swift
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ TransactionHistoryCache.swift
    ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ SettingsStorage.swift
    ‚îÇ   ‚îú‚îÄ‚îÄ Presentation/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Screens/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Swap/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SwapView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SwapViewModel.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TokenSelectorView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SwapConfirmationSheet.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SwapSettingsView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Pools/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PoolsListView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PoolsViewModel.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PoolDetailView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddLiquidityView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RemoveLiquidityView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Portfolio/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PortfolioView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PortfolioViewModel.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PositionCardView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TokenBalanceRow.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Wallet/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WalletView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WalletViewModel.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ConnectWalletSheet.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Analytics/
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AnalyticsView.swift
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AnalyticsViewModel.swift
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ PriceChartView.swift
    ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ VolumeChartView.swift
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Components/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TokenInputField.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TokenAmountView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PriceImpactBadge.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SlippageSelector.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PoolStatsCard.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TransactionStatusView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChartView.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GradientButton.swift
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Navigation/
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ MainTabView.swift
    ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ NavigationCoordinator.swift
    ‚îÇ   ‚îú‚îÄ‚îÄ Core/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DependencyInjection/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DIContainer.swift
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Extensions/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BigInt+Extensions.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Decimal+Crypto.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ String+Address.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Color+DeFi.swift
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Constants/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BlockchainConstants.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ContractAddresses.swift
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AppConstants.swift
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Utilities/
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ PriceCalculator.swift
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ SlippageCalculator.swift
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ NumberFormatter+Crypto.swift
    ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Logger.swift
    ‚îÇ   ‚îî‚îÄ‚îÄ Resources/
    ‚îÇ       ‚îú‚îÄ‚îÄ Assets.xcassets
    ‚îÇ       ‚îú‚îÄ‚îÄ TokenIcons/
    ‚îÇ       ‚îî‚îÄ‚îÄ Info.plist
    ‚îî‚îÄ‚îÄ PrivateDEX.xcodeproj

====================================================================
üîß SMART CONTRACT SPECIFICATIONS
====================================================================

CONTRACT 1: PrivateAMM.sol
--------------------------
Core AMM implementing constant product formula (x * y = k) with privacy.

Key Features:
- Uses COTI's ctUint64 for encrypted reserves
- Private swap amounts (no one sees how much you swap)
- Encrypted LP token balances
- MPC-secured price calculations

Required Functions:
- swap(itUint64 amountIn, address tokenIn, address tokenOut, itUint64 minAmountOut)
- getReserves() returns (ctUint64, ctUint64) [encrypted]
- getPrice(address tokenIn, address tokenOut) returns (uint256) [public price ratio]

CONTRACT 2: PrivateLiquidityPool.sol
------------------------------------
Manages liquidity positions with encrypted balances.

Required Functions:
- addLiquidity(itUint64 amount0, itUint64 amount1) returns (ctUint64 lpTokens)
- removeLiquidity(itUint64 lpAmount) returns (ctUint64, ctUint64)
- getMyPosition() returns (ctUint64) [caller's encrypted LP balance]
- getTotalLiquidity() returns (uint256) [public total for calculations]

CONTRACT 3: PrivateRouter.sol
-----------------------------
Routes swaps and calculates optimal paths.

Required Functions:
- swapExactTokensForTokens(itUint64 amountIn, itUint64 amountOutMin, address[] path)
- getAmountOut(uint256 amountIn, address[] path) returns (uint256)
- calculatePriceImpact(uint256 amountIn, address[] path) returns (uint256)

====================================================================
üîê PRIVACY ARCHITECTURE
====================================================================

WHAT'S PRIVATE (Encrypted with MPC):
- Individual wallet balances
- Swap amounts (input and output)
- Liquidity positions
- Transaction values

WHAT'S PUBLIC (For AMM to function):
- Total pool reserves (needed for price calculation)
- Price ratios between tokens
- Pool existence and token pairs
- Transaction success/failure status

This hybrid approach allows:
‚úì Accurate price discovery
‚úì Slippage calculations
‚úì Yet complete privacy for individual users

====================================================================
üì± iOS UI/UX REQUIREMENTS
====================================================================

SCREEN 1: SWAP (Main Screen)
- Token input/output fields with balance display
- Real-time price calculation
- Price impact warning (if > 1%)
- Slippage tolerance selector
- "Swap" button with confirmation sheet
- Transaction status tracking

SCREEN 2: POOLS
- List of available liquidity pools
- APY/APR estimates
- Your positions highlighted
- Add/Remove liquidity flows
- Pool statistics (TVL, volume, fees)

SCREEN 3: PORTFOLIO
- Your token balances (decrypted for owner)
- Your LP positions
- Total portfolio value
- Recent transactions
- PnL tracking

SCREEN 4: ANALYTICS
- Price charts (candlestick/line)
- Volume charts
- TVL over time
- Top pools by volume/TVL

Design Theme:
- Dark mode primary (DeFi standard)
- Accent colors: Purple (#8B5CF6), Pink (#EC4899)
- Glassmorphism effects
- Smooth animations (0.3s standard)
- Haptic feedback on transactions

====================================================================
üîß DEPENDENCIES
====================================================================

Smart Contracts:
- @coti-io/coti-contracts (MPC primitives)
- @openzeppelin/contracts (security patterns)
- hardhat + ethers.js (development)

iOS App:
- web3.swift (blockchain interactions)
- WalletConnectSwiftV2 (wallet connection)
- BigInt (large number handling)
- Charts (for analytics)

====================================================================
üì§ DELIVERABLES FOR THIS PHASE
====================================================================

1. Complete folder structure for both SmartContracts/ and iOSApp/
2. All interface definitions (IPrivateAMM, IPrivateRouter, etc.)
3. Domain entities for iOS (Token, Pool, SwapQuote, etc.)
4. Repository protocols
5. DIContainer setup
6. Basic navigation structure (MainTabView)
7. Blockchain constants file with:
   - COTI Devnet RPC: https://testnet.coti.io/rpc
   - Chain ID: 7082400
   - Block Explorer: https://testnet.cotiscan.io

Generate all the code with detailed comments explaining the DeFi concepts.`}
    </div>

    {/* Visual Footer */}
    <div style={{
        background: '#020617',
        borderTop: '1px solid #1e293b',
        padding: '8px 20px',
        display: 'flex', justifyContent: 'flex-end',
        alignItems: 'center', gap: '10px'
    }}>
        <div style={{width:'8px', height:'8px', background:'#8b5cf6', borderRadius:'50%', animation: 'pulse 2s infinite'}}></div>
        <span style={{fontSize: '0.7rem', color: '#94a3b8', fontFamily: 'sans-serif', fontWeight: 'bold'}}>
          SCROLL FOR COMPLETE SPECS ‚Üï
        </span>
    </div>

  </div>
</div>

---

## üéì Architecture Deep Dive

### The AMM Formula: x * y = k

This is the heart of Uniswap-style DEXs:

<div style={{
  background: 'rgba(139, 92, 246, 0.1)',
  border: '1px solid rgba(139, 92, 246, 0.3)',
  borderRadius: '12px',
  padding: '20px',
  margin: '20px 0'
}}>

```
Reserve A √ó Reserve B = Constant (k)

Example:
- Pool has 1000 ETH and 2,000,000 USDC
- k = 1000 √ó 2,000,000 = 2,000,000,000

When swapping 10 ETH for USDC:
- New ETH reserve = 1010
- New USDC reserve = k / 1010 = 1,980,198 USDC
- User receives = 2,000,000 - 1,980,198 = 19,802 USDC
```

</div>

### Privacy Layer

<div style={{
  background: 'rgba(16, 185, 129, 0.1)',
  border: '1px solid rgba(16, 185, 129, 0.3)',
  borderRadius: '8px',
  padding: '16px',
  margin: '10px 0'
}}>
  <span style={{color: '#10b981', fontWeight: 'bold'}}>üìö Why Privacy Matters in DeFi:</span>
  <ul style={{marginTop: '10px', paddingLeft: '20px'}}>
    <li>Prevents front-running attacks</li>
    <li>Protects trading strategies</li>
    <li>Hides wallet wealth from observers</li>
    <li>Enables confidential OTC-style trades</li>
  </ul>
</div>

---

## ‚úÖ Checkpoint

After this phase, you'll have:

- ‚úÖ Complete project structure for smart contracts AND iOS app
- ‚úÖ Understanding of AMM mathematics
- ‚úÖ Privacy architecture designed
- ‚úÖ All interfaces and protocols defined
- ‚úÖ Navigation and DI ready

**Next Step:** Implement the AMM smart contracts with privacy!
