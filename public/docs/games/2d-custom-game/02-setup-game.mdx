# üïπÔ∏è Project: The Privacy Arcade (Full Stack)

This is the final boss. We are generating the complete flow: **Wallet Connection**, **Gas-Safe Onboarding**, **AES Encryption**, and a **Full-Screen Interactive Game**.

---

## ‚ö° ACTION: BUILD THE FULL EXPERIENCE

**Mission:** Go to the **COTI MCP Interface**. Copy the prompt inside the terminal below and paste it into the chat.

<div style={{
  background: 'linear-gradient(135deg, #4f46e5, #f472b6, #8b5cf6)',
  padding: '3px',
  borderRadius: '16px',
  margin: '30px 0',
  boxShadow: '0 0 50px -10px rgba(79, 70, 229, 0.4)'
}}>
  <div style={{
    background: '#0f172a',
    borderRadius: '13px',
    color: '#e2e8f0',
    overflow: 'hidden',
    fontFamily: 'Menlo, Monaco, Consolas, monospace',
    position: 'relative'
  }}>
    
    {/* Header Bar */}
    <div style={{
      background: 'rgba(255, 255, 255, 0.03)',
      borderBottom: '1px solid #334155',
      padding: '12px 20px',
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center'
    }}>
      <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
        <div style={{
            width:'12px', height:'12px', background:'#22d3ee', borderRadius:'50%', 
            boxShadow:'0 0 12px #22d3ee'
        }}></div>
        <span style={{color: '#e2e8f0', fontWeight: 'bold', fontSize: '0.85rem', letterSpacing: '0.5px'}}>
          ARCADE_CORE_V1.prompt
        </span>
        <span style={{
            background: 'rgba(244, 114, 182, 0.2)', color: '#f472b6', fontSize: '0.65rem', 
            padding: '2px 8px', borderRadius: '4px', border: '1px solid rgba(244, 114, 182, 0.3)'
        }}>FULL SCREEN</span>
      </div>

      <button 
        style={{
            background: 'linear-gradient(90deg, #6366f1, #8b5cf6)',
            border: 'none',
            color: 'white',
            padding: '8px 16px',
            borderRadius: '6px',
            fontSize: '0.75rem',
            cursor: 'pointer',
            fontWeight: 'bold',
            display: 'flex', alignItems: 'center', gap: '8px',
            transition: 'transform 0.1s',
            boxShadow: '0 4px 12px rgba(99, 102, 241, 0.3)'
        }}
        onMouseOver={(e) => e.currentTarget.style.transform = 'translateY(-1px)'}
        onMouseOut={(e) => e.currentTarget.style.transform = 'translateY(0)'}
        onClick={() => {
            const promptText = document.getElementById('arcade-prompt').innerText;
            navigator.clipboard.writeText(promptText);
            alert("System Prompt Copied! Ready to Deploy üëæ");
        }}
      >
        <span>‚ö° COPY SYSTEM PROMPT</span>
      </button>
    </div>

    {/* Scrollable Content Area - FIX: Wrapped in backticks */}
    <div id="arcade-prompt" style={{
      padding: '24px',
      maxHeight: '400px',
      overflowY: 'auto',
      whiteSpace: 'pre-wrap',
      fontSize: '0.85rem',
      lineHeight: '1.5',
      color: '#cbd5e1'
    }}>
{`Purpose: Create a React + TypeScript implementation with:

Wallet connection
Automatic COTI Testnet switching
Onboarding via COTI onboarding contract
AESKey derivation using real COTI SDK
Native COTI balance fetching
2D game locked until onboarding success
Strict rule: All blockchain transactions MUST use the real connected signer
Never use derived wallets to send transactions
No fake AESKey
No architecture imposed

CRITICAL NEW RULE (Preventing Gas Errors)
You MUST follow this instruction:

All blockchain transactions must be executed using the real connected signer obtained from window.ethereum (via provider.getSigner() or new BrowserProvider(...).getSigner()).

Do NOT use wallets derived from signatures
Do NOT use RSA-generated keys as wallets
Do NOT use recoverUserKey output as a wallet
Do NOT construct a new Wallet(privateKey, provider) for sending transactions

The only wallet allowed to send transactions is the actual connected wallet that the user controls and that has funds.

This prevents the error:
insufficient funds for intrinsic transaction cost

because onboarding requires gas, and only the connected signer has funds.

All contract writes must use:

const provider = new ethers.BrowserProvider(window.ethereum);
const signer = await provider.getSigner();

const contract = new Contract(ONBOARD_CONTRACT_ADDRESS, ABI, signer);
await contract.onboardAccount(...);

Never any other signer.

1. React + TypeScript + Ethers + COTI SDK + Onboarding + AESKey + Balance + Game Lock

STEP 1 ‚Äî Wallet Connection

Produce a minimal React UI with:

A centered Connect Wallet button
Uses ethers v6
Switches or adds COTI Testnet

After success:
Show wallet address
Show native COTI balance
Show Onboard button

Use these network parameters:

Network name: COTI Testnet
RPC URL: https://testnet.coti.io/rpc
WS URL: wss://testnet.coti.io/ws
Chain ID: 7082400 (hex: 0x6c11a0)
Currency symbol: COTI
Explorer: https://testnet.cotiscan.io
Status: https://uptime.coti.io

STEP 2 ‚Äî Onboarding

The Onboard button must run this function EXACTLY, using ONLY the real connected signer:

async function onboard(wallet: Wallet) {
    const accountOnboardContract = new Contract(
        ONBOARD_CONTRACT_ADDRESS,
        JSON.stringify(ONBOARD_CONTRACT_ABI),
        wallet
    );

    const rsaKeyPair = generateRSAKeyPair();

    const signedEK = sign(keccak256(rsaKeyPair.publicKey), wallet.privateKey);

    const receipt = await (
        await accountOnboardContract.onboardAccount(
            rsaKeyPair.publicKey,
            signedEK,
            { gasLimit: 15000000 }
        )
    ).wait();

    const decodedLog = accountOnboardContract.interface.parseLog(receipt.logs[0]);

    return recoverUserKey(
        rsaKeyPair.privateKey,
        decodedLog!.args.userKey1.substring(2),
        decodedLog!.args.userKey2.substring(2)
    );
}

Important:
The parameter wallet passed into onboard(wallet) must be the real connected signer, not a derived wallet.

Use this corrected address:
0x536A67f0cc46513E7d27a370ed1aF9FDcC7A5095

Use the ABI exactly as previously shown.

STEP 3 ‚Äî AESKey Extraction

Requirements:
Use the SDK to derive the AESKey from the userKey returned by onboarding
No mock values
No placeholder AESKey
Store AESKey in state
Display AESKey

Your implementation must derive the AESKey through real COTI SDK logic (decrypt, build inputs, etc.).

STEP 4 ‚Äî COTI Native Balance

After wallet connection:
Use provider.getBalance(address)
Display native COTI balance
Optionally refresh after onboarding

STEP 5 ‚Äî Game Locking Logic

The 2D game must NOT initialize until:
Wallet connected
Onboarding completed
AESKey derived
No errors

Implement the guard:

if (!walletConnected || !onboardingComplete || !aesKey) {
    return <div>Please complete onboarding before accessing the game.</div>;
}

2. Full-Screen 2D Game (React + TypeScript)

After the wallet/onboarding/AESKey section, produce a separate section with a different 2D game:

- The game MUST run in a dedicated ‚ÄúGame Screen‚Äù that takes the full browser viewport (100vw x 100vh).
- Use React state to switch between the ‚ÄúOnboarding Screen‚Äù and the ‚ÄúGame Screen‚Äù, e.g.:

  const [currentScreen, setCurrentScreen] = useState<"onboarding" | "game">("onboarding");

- After onboarding + AESKey success, show a button like ‚ÄúStart Game‚Äù that calls:

  setCurrentScreen("game");

- The game itself must:

  - Be 2D and interactive
  - Use a <canvas> or DOM elements
  - Run full-screen (no visible scrollbars, game area covers whole window)
  - Use requestAnimationFrame for animation
  - Be implemented in React + TypeScript only (no external game engines or libraries)
  - Be visually simple but pleasant

- Game concept (different from the previous examples):

  Implement a ‚Äútop-down dodge & collect‚Äù game:

  - The player is a small square or circle controlled with arrow keys or WASD.
  - Colorful orbs spawn at random positions and drift downward.
  - Red obstacles (e.g., squares) also fall from the top.
  - The player gains points when collecting orbs.
  - The player must avoid colliding with red obstacles.
  - When a collision with an obstacle occurs, show a ‚ÄúGame Over‚Äù overlay and a ‚ÄúRestart‚Äù button that resets the game state.

- The game MUST only render and update if onboarding is complete and AESKey exists (the guard from STEP 5 must still apply at the app level).

3. Output Format

Your response must contain:

Section 1: Wallet + Onboarding + AESKey + Balance + Game Lock Code
Section 2: Full-screen 2D Game Code based on the ‚Äúdodge & collect‚Äù concept, using a second screen/view

All in English.
No emojis.
Minimal inline CSS.
No unnecessary explanations.`}
    </div>

    {/* Visual Footer */}
    <div style={{
        background: '#020617',
        borderTop: '1px solid #1e293b',
        padding: '8px 20px',
        display: 'flex', justifyContent: 'flex-end',
        alignItems: 'center', gap: '10px'
    }}>
        <div style={{width:'8px', height:'8px', background:'#22d3ee', borderRadius:'50%', animation: 'pulse 2s infinite'}}></div>
        <span style={{fontSize: '0.7rem', color: '#94a3b8', fontFamily: 'sans-serif', fontWeight: 'bold'}}>
          SCROLL TO VIEW FULL SPECIFICATION ‚Üï
        </span>
    </div>

  </div>
</div>