# üí∞ Phase 5: The Economic Gatekeeper

We are adding a layer of "Skin in the Game". It's not enough to just connect a wallet; the user must hold actual **COTI** to play.

This prompt instructs the AI to use the specialized **`coti-ethers`** provider to avoid common ENS errors and strictly enforce a minimum balance.

---

## ‚ö° ACTION: IMPLEMENT BALANCE GATING

**Mission:** Go to the **COTI MCP Interface**. Copy the prompt inside the terminal below and paste it into the chat.

<div style={{
  background: 'linear-gradient(135deg, #059669, #fbbf24)',
  padding: '3px',
  borderRadius: '16px',
  margin: '30px 0',
  boxShadow: '0 0 50px -10px rgba(16, 185, 129, 0.4)'
}}>
  <div style={{
    background: '#0f172a',
    borderRadius: '13px',
    color: '#e2e8f0',
    overflow: 'hidden',
    fontFamily: 'Menlo, Monaco, Consolas, monospace',
    position: 'relative'
  }}>
    
    {/* Header Bar */}
    <div style={{
      background: 'rgba(255, 255, 255, 0.03)',
      borderBottom: '1px solid #334155',
      padding: '12px 20px',
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center'
    }}>
      <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
        <div style={{
            width:'12px', height:'12px', background:'#fbbf24', borderRadius:'50%', 
            boxShadow:'0 0 12px #fbbf24'
        }}></div>
        <span style={{color: '#fcd34d', fontWeight: 'bold', fontSize: '0.85rem', letterSpacing: '0.5px'}}>
          BALANCE_CHECKER.ts
        </span>
        <span style={{
            background: 'rgba(5, 150, 105, 0.3)', color: '#6ee7b7', fontSize: '0.65rem', 
            padding: '2px 8px', borderRadius: '4px', border: '1px solid rgba(5, 150, 105, 0.4)'
        }}>COTI-ETHERS</span>
      </div>

      <button 
        style={{
            background: 'linear-gradient(90deg, #059669, #d97706)',
            border: 'none',
            color: 'white',
            padding: '8px 16px',
            borderRadius: '6px',
            fontSize: '0.75rem',
            cursor: 'pointer',
            fontWeight: 'bold',
            display: 'flex', alignItems: 'center', gap: '8px',
            transition: 'transform 0.1s',
            boxShadow: '0 4px 12px rgba(5, 150, 105, 0.3)'
        }}
        onMouseOver={(e) => e.currentTarget.style.transform = 'translateY(-1px)'}
        onMouseOut={(e) => e.currentTarget.style.transform = 'translateY(0)'}
        onClick={() => {
            const promptText = document.getElementById('balance-prompt').innerText;
            navigator.clipboard.writeText(promptText);
            alert("Financial Logic Copied! ü§ë");
        }}
      >
        <span>‚ö° COPY LOGIC</span>
      </button>
    </div>

    {/* Scrollable Content Area */}
    <div id="balance-prompt" style={{
      padding: '24px',
      maxHeight: '450px',
      overflowY: 'auto',
      whiteSpace: 'pre-wrap',
      fontSize: '0.85rem',
      lineHeight: '1.5',
      color: '#cbd5e1'
    }}>
{`Your task is to generate React + TypeScript code that reads the user‚Äôs native COTI balance using the coti-ethers library, and enforces a minimum balance of 1 COTI before allowing the existing game to start. The implementation MUST follow these exact rules:

====================================================================
REQUIREMENTS
====================================================================

1. Use the coti-ethers library for all balance operations.  
   You MUST import and use the BrowserProvider from coti-ethers:

   import { BrowserProvider } from "@coti-io/coti-ethers";

   Do NOT use ethers.js built-in providers for balance retrieval.

2. Always initialize the provider like this to avoid ENS-related errors:

   const provider = new BrowserProvider(window.ethereum, {
     name: "coti-testnet",
     chainId: 7082400
   });

3. Automatically switch the user's wallet to the COTI Testnet before any reads:

   chainId: "0x6c11a0"
   rpcUrl: "https://testnet.coti.io/rpc"
   currency symbol: "COTI"

   If the network is missing, add it using wallet_addEthereumChain.

4. After switching networks, obtain the signer:

   const signer = await provider.getSigner();
   const userAddress = await signer.getAddress();

5. Read the user's native COTI balance:

   const rawBalance = await provider.getBalance(userAddress);

   Convert it safely to a human-readable number:

   const balance = Number(rawBalance) / 1e18;

6. Enforce a hard requirement:
   
   The game MUST NOT initialize unless:

   balance >= 1.0

   If the balance is below 1 COTI:
   - show a UI message "Insufficient COTI balance: at least 1 COTI required."
   - do NOT allow the game to start
   - provide a retry button that re-checks balance

7. When the user has >= 1 COTI:
   - unlock the "Start Game" button
   - return a boolean flag like: { allowed: true, balance }

8. Follow best practices:
   - Use async/await throughout
   - Always wrap network operations in try/catch
   - Never assume the provider exists; check window.ethereum first
   - Display loading states and error messages to the user
   - Do not mix ethers.js v6 providers with coti-ethers providers
   - Do not use deprecated or private APIs

====================================================================
OUTPUT FORMAT
====================================================================

Your response must contain:

SECTION 1 ‚Äî The complete React hook or utility function that:
- switches network
- initializes BrowserProvider
- reads COTI balance
- enforces the >= 1 COTI rule
- returns a structured object containing { balance, allowed, error }

SECTION 2 ‚Äî Example React component snippet showing:
- UI state for balance loading / errors
- a disabled ‚ÄúStart Game‚Äù button when balance < 1 COTI
- an enabled ‚ÄúStart Game‚Äù button when balance >= 1 COTI

No extra commentary.  
No emojis.  
Clean, production-ready code only.`}
    </div>

    {/* Visual Footer */}
    <div style={{
        background: '#020617',
        borderTop: '1px solid #1e293b',
        padding: '8px 20px',
        display: 'flex', justifyContent: 'flex-end',
        alignItems: 'center', gap: '10px'
    }}>
        <div style={{width:'8px', height:'8px', background:'#fbbf24', borderRadius:'50%', animation: 'pulse 2s infinite'}}></div>
        <span style={{fontSize: '0.7rem', color: '#94a3b8', fontFamily: 'sans-serif', fontWeight: 'bold'}}>
          SCROLL TO VIEW FULL SPECIFICATION ‚Üï
        </span>
    </div>

  </div>
</div>